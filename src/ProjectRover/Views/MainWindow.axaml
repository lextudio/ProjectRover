<!--
    Copyright 2024 CodeMerx
    Copyright 2025 LeXtudio Inc.
    This file is part of ProjectRover.

    ProjectRover is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    ProjectRover is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with ProjectRover.  If not, see<https://www.gnu.org/licenses/>.
-->

<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:ProjectRover.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:avaloniaEdit="clr-namespace:AvaloniaEdit;assembly=AvaloniaEdit"
        xmlns:nodes="clr-namespace:ProjectRover.Nodes"
        xmlns:searchResults="clr-namespace:ProjectRover.SearchResults"
        xmlns:views="clr-namespace:ProjectRover.Views"
        xmlns:design="clr-namespace:ProjectRover.ViewModels.Design"
        xmlns:converters="clr-namespace:ProjectRover.Converters"
        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
        x:Class="ProjectRover.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/ilspyrover-logo.ico"
        Title="Project Rover">

    <Design.DataContext>
        <design:DesignMainWindowViewModel />
    </Design.DataContext>
    
    <NativeMenu.Menu>
        <NativeMenu>
            <NativeMenuItem Header="Assembly">
                <NativeMenu>
                    <NativeMenuItem Header="Open Assembly..."
                                    Command="{Binding OpenFileCommand}"
                                    Gesture="Cmd+O" />
                    <NativeMenuItemSeparator />
                    <NativeMenuItem Header="Close All"
                                    Command="{Binding ClearAssemblyListCommand}" />
                </NativeMenu>
            </NativeMenuItem>
            <NativeMenuItem Header="Navigate">
                <NativeMenu>
                    <NativeMenuItem Header="Back"
                                    Command="{Binding BackCommand}"
                                    Gesture="Cmd+-" />
                    <NativeMenuItem Header="Forward"
                                    Command="{Binding ForwardCommand}"
                                    Gesture="Cmd+Shift+-" />
                    <NativeMenuItem Header="Collapse All"
                                    Command="{Binding CollapseAllCommand}" />
                    <NativeMenuItemSeparator />
                    <NativeMenuItem Header="Search"
                                    Command="{Binding OpenSearchPaneCommand}"
                                    Gesture="Cmd+Shift+F" />
                </NativeMenu>
            </NativeMenuItem>
            <NativeMenuItem Header="View">
                <NativeMenu>
                    <NativeMenuItem Header="Theme">
                        <NativeMenu>
                            <NativeMenuItem Header="Light"
                                            ToggleType="Radio"
                                            IsChecked="{Binding SelectedTheme.Name, Converter={StaticResource ThemeEqualityConverter}, ConverterParameter=Light, Mode=OneWay}"
                                            Command="{Binding SetThemeCommand}"
                                            CommandParameter="{Binding Themes[0]}" />
                            <NativeMenuItem Header="Dark"
                                            ToggleType="Radio"
                                            IsChecked="{Binding SelectedTheme.Name, Converter={StaticResource ThemeEqualityConverter}, ConverterParameter=Dark, Mode=OneWay}"
                                            Command="{Binding SetThemeCommand}"
                                            CommandParameter="{Binding Themes[1]}" />
                        </NativeMenu>
                    </NativeMenuItem>
                </NativeMenu>
            </NativeMenuItem>
        </NativeMenu>
    </NativeMenu.Menu>

    <Grid>
        <DockPanel>
            <Menu DockPanel.Dock="Top"
                  IsVisible="{OnPlatform Windows='true', Linux='true', macOS='false'}">
                <MenuItem Header="_Assembly">
                    <MenuItem Header="_Open Assembly..."
                              Command="{Binding OpenFileCommand}"
                              HotKey="Ctrl+O"
                              InputGesture="Ctrl+O" />
                    <Separator/>
                    <MenuItem Header="_Close All"
                              Command="{Binding ClearAssemblyListCommand}" />
                </MenuItem>
                <MenuItem Header="_Navigate">
                    <MenuItem Header="_Back"
                              Command="{Binding BackCommand}"
                              HotKey="Ctrl+-"
                              InputGesture="Ctrl+-" />
                    <MenuItem Header="_Forward"
                              Command="{Binding ForwardCommand}"
                              HotKey="Ctrl+Shift+-"
                              InputGesture="Ctrl+Shift+-" />
                    <MenuItem Header="_Sort Assemblies"
                              Command="{Binding SortAssembliesCommand}" />
                    <Separator />
                    <MenuItem Header="_Collapse All"
                              Command="{Binding CollapseAllCommand}" />
                    <Separator />
                    <MenuItem Header="_Search"
                              Command="{Binding OpenSearchPaneCommand}"
                              HotKey="Ctrl+Shift+F"
                              InputGesture="Ctrl+Shift+F" />
                </MenuItem>
                <MenuItem Header="_View">
                    <MenuItem Header="_Theme">
                        <MenuItem.Items>
                            <ItemsControl ItemsSource="{Binding Themes}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <MenuItem Header="{Binding Name}"
                                                  ToggleType="Radio"
                                                  x:CompileBindings="False"
                                                  Command="{Binding DataContext.SetThemeCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                  CommandParameter="{Binding}">
                                            <MenuItem.IsChecked>
                                                <MultiBinding Converter="{StaticResource EqualityMultiConverter}" Mode="OneWay">
                                                    <Binding Path="DataContext.SelectedTheme" RelativeSource="{RelativeSource AncestorType=Window}" />
                                                    <Binding Path="." />
                                                </MultiBinding>
                                            </MenuItem.IsChecked>
                                        </MenuItem>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </MenuItem.Items>
                    </MenuItem>
                </MenuItem>
                <MenuItem Header="_Help">
                    <MenuItem Header="_About"
                              Command="{Binding OpenAboutDialogCommand}" />
                </MenuItem>
            </Menu>
            
            <Border DockPanel.Dock="Top"
                    Classes="menu-bar">
                <Border.Styles>
                    <Style Selector="Border.menu-bar">
                        <Setter Property="Padding" Value="5" />
                        <Setter Property="Background" Value="{DynamicResource ToolbarBackgroundBrush}" />
                        <Setter Property="BorderThickness" Value="0 0 0 1" />
                        <Setter Property="BorderBrush" Value="{DynamicResource ToolbarBorderBrush}" />
                    </Style>
                </Border.Styles>
                
                <StackPanel Orientation="Horizontal">
                    <StackPanel.Styles>
                        <Style Selector="Button">
                            <Setter Property="Margin" Value="0 0 5 0" />
                        </Style>
                        <Style Selector="Border.separator">
                            <Setter Property="Margin" Value="5 5 10 5" />
                            <Setter Property="BorderThickness" Value="0.5" />
                            <Setter Property="BorderBrush" Value="{DynamicResource ToolbarSeparatorBrush}" />
                            <Setter Property="Width" Value="1" />
                        </Style>
                    </StackPanel.Styles>
                    
                    <Button Command="{Binding BackCommand}"
                            ToolTip.Tip="Back">
                        <Svg Width="16" Height="16" Path="{DynamicResource BackIcon}" />
                    </Button>
                    <Button Command="{Binding ForwardCommand}"
                            ToolTip.Tip="Forward">
                        <Svg Width="16" Height="16" Path="{DynamicResource ForwardIcon}" />
                    </Button>
                    
                    <Border Classes="separator" />
                
                    <Button Command="{Binding OpenFileCommand}"
                            ToolTip.Tip="Open assembly">
                        <Svg Width="16" Height="16" Path="{DynamicResource OpenIcon}" />
                    </Button>
                    <Button Command="{Binding ClearAssemblyListCommand}"
                            ToolTip.Tip="Close all">
                        <Svg Width="16" Height="16" Path="{DynamicResource ClearIcon}" />
                    </Button>

                    <Border Classes="separator" />
                
                    <ComboBox ItemsSource="{Binding Languages}"
                              SelectedItem="{Binding SelectedLanguage}">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Name}" />
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                    <ComboBox ItemsSource="{Binding LanguageVersions}"
                              SelectedItem="{Binding SelectedLanguageVersion}"
                              IsVisible="{Binding HasLanguageVersions}">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Name}" />
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>

                    <Border Classes="separator" />

                    <Button Command="{Binding SortAssembliesCommand}"
                            ToolTip.Tip="Sort assemblies">
                        <Svg Width="16" Height="16" Path="{DynamicResource SortIcon}" />
                    </Button>

                    <Button Command="{Binding CollapseAllCommand}"
                            ToolTip.Tip="Collapse all">
                        <Svg Width="16" Height="16" Path="{DynamicResource CollapseIcon}" />
                    </Button>
                </StackPanel>
            </Border>
            
            <Border DockPanel.Dock="Bottom"
                    Classes="status-bar">
                <Border.Styles>
                    <Style Selector="Border.status-bar">
                        <Setter Property="Background" Value="{DynamicResource StatusBarBackgroundBrush}" />
                        <Setter Property="BorderThickness" Value="0 1 0 0" />
                        <Setter Property="BorderBrush" Value="{DynamicResource StatusBarBorderBrush}" />
                        <Setter Property="Padding" Value="10 0" />
                    </Style>
                    
                    <Style Selector="Border.status-bar-item">
                        <Setter Property="Padding" Value="5" />
                    </Style>
                    
                    <Style Selector="Border.status-bar-item:pointerover">
                        <Setter Property="Background" Value="{DynamicResource StatusBarHoverBrush}" />
                        <Setter Property="Cursor" Value="Hand" />
                    </Style>
                </Border.Styles>
                
                <DockPanel LastChildFill="False">
                    <StackPanel DockPanel.Dock="Right"
                                Orientation="Horizontal">
                        <Border Classes="status-bar-item">
                            <Interaction.Behaviors>
                                <EventTriggerBehavior EventName="PointerPressed">
                                    <InvokeCommandAction Command="{Binding ToggleShowCompilerGeneratedMembersCommand}" />
                                </EventTriggerBehavior>
                            </Interaction.Behaviors>
                            
                            <TextBlock Text="{Binding ShowCompilerGeneratedMembers, StringFormat='Compiler generated members: {0}', Converter={x:Static converters:ToStringConverters.BooleanToOnOff}}" />
                        </Border>
                    </StackPanel>
                </DockPanel>
            </Border>
            
            <Grid DragDrop.AllowDrop="True">
                <Grid ColumnDefinitions="*, Auto, 3*">
                    <DockPanel>
                        <ListBox DockPanel.Dock="Left"
                                 SelectionMode="AlwaysSelected"
                                 SelectedIndex="{Binding SelectedPaneIndex}"
                                 Background="Transparent"
                                 BorderBrush="#DFDFDF"
                                 BorderThickness="0 0 1 0">
                            <ListBox.Styles>
                                <Style Selector="Svg">
                                    <Setter Property="Width" Value="16" />
                                </Style>
                                <Style Selector="ListBoxItem">
                                    <Setter Property="Cursor" Value="Hand" />
                                </Style>
                            </ListBox.Styles>
                            <ListBoxItem>
                                <Svg Path="{DynamicResource AssemblyIcon}" />
                            </ListBoxItem>
                            <ListBoxItem>
                                <Svg Path="{DynamicResource SearchIcon}" />
                            </ListBoxItem>
                        </ListBox>
                        <Grid>
                            <TreeView Name="TreeView"
                                      ItemsSource="{Binding AssemblyNodes}"
                                      SelectionMode="Single"
                                      SelectedItem="{Binding SelectedNode}" 
                                      AutoScrollToSelectedItem="True"
                                      ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                      Foreground="{DynamicResource ThemeForegroundBrush}">
                                <TreeView.Styles>
                                    <Style Selector="TextBlock" x:DataType="nodes:Node">
                                        <Setter Property="Foreground" Value="{Binding IsPublicAPI, Converter={StaticResource ApiVisibilityToBrushConverter}}" />
                                    </Style>
                                    <Style Selector="Svg">
                                        <Setter Property="Margin" Value="0 0 5 0" />
                                    </Style>
                                    <Style Selector="TreeViewItem" x:DataType="nodes:Node">
                                        <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                                    </Style>
                                </TreeView.Styles>
                                
                                <TreeView.DataTemplates>
                                    <TreeDataTemplate DataType="nodes:AssemblyNode" ItemsSource="{Binding Children}">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{DynamicResource ReferenceIcon}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:MetadataNode" ItemsSource="{Binding Items}">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{DynamicResource MetadataIcon}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:DebugMetadataNode" ItemsSource="{Binding Items}">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{DynamicResource DebugMetadataIcon}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:MetadataTablesNode" ItemsSource="{Binding Items}">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{DynamicResource TablesIcon}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:MetadataHeaderNode">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{DynamicResource HeaderIcon}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:MetadataDirectoryNode">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{DynamicResource FileDialogReportIcon}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:MetadataHeapNode">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{DynamicResource HeapIcon}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:MetadataTableNode">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{DynamicResource DataTableIcon}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:MetadataLeafNode">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{DynamicResource MetadataIcon}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:ReferencesNode" ItemsSource="{Binding Items}">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{DynamicResource ReferenceGroupIcon}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:ResourcesNode" ItemsSource="{Binding Items}">
                                        <StackPanel Orientation="Horizontal">
                                            <Panel>
                                                <Svg Path="{DynamicResource ResourcesIconClosed}" IsVisible="{Binding !IsExpanded}" />
                                                <Svg Path="{DynamicResource ResourcesIconOpen}" IsVisible="{Binding IsExpanded}" />
                                            </Panel>
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:ResourceNode">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{DynamicResource ResourceFileIcon}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:ResolvedReferenceNode">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{DynamicResource ReferenceIcon}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:UnresolvedReferenceNode">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{DynamicResource ReferenceWarningIcon}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:NamespaceNode" ItemsSource="{Binding Types}">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{DynamicResource NamespaceIcon}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:EnumNode" ItemsSource="{Binding Members}">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{DynamicResource EnumIcon}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:StructNode" ItemsSource="{Binding Members}">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{DynamicResource StructIcon}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:ClassNode" ItemsSource="{Binding Members}">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{Binding IconKey, Converter={StaticResource IconKeyToPathConverter}}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:InterfaceNode" ItemsSource="{Binding Members}">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{DynamicResource InterfaceIcon}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:FieldNode">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{DynamicResource FieldIcon}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:PropertyNode">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{DynamicResource PropertyIcon}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:ConstructorNode">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{DynamicResource ConstructorIcon}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:MethodNode">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{DynamicResource MethodIcon}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                    <TreeDataTemplate DataType="nodes:EventNode">
                                        <StackPanel Orientation="Horizontal">
                                            <Svg Path="{DynamicResource EventIcon}" />
                                            <TextBlock Text="{Binding Name}" />
                                        </StackPanel>
                                    </TreeDataTemplate>
                                </TreeView.DataTemplates>
                            </TreeView>
                            <DockPanel IsVisible="{Binding SearchPaneSelected}"
                                       Background="White">
                                <Grid DockPanel.Dock="Top"
                                      Height="2">
                                    <ProgressBar IsVisible="{Binding IsSearching}"
                                                 IsIndeterminate="True"
                                                 Height="2"
                                                 MinHeight="2"
                                                 Background="Transparent"
                                                 CornerRadius="0" />
                                </Grid>
                                <TextBox DockPanel.Dock="Top"
                                         Name="SearchTextBox"
                                         Watermark="Search..."
                                         Text="{Binding SearchText}"
                                         Margin="5" />
                                <TextBlock DockPanel.Dock="Top"
                                           Text="{Binding NumberOfResultsText}"
                                           IsVisible="{Binding NumberOfResultsText, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                           Margin="10 5 0 5"
                                           Foreground="#919191"
                                           FontSize="12"/>
                                <ListBox ItemsSource="{Binding SearchResults}"
                                         SelectedItem="{Binding SelectedSearchResult}"
                                         Background="Transparent">
                                    <ListBox.Styles>
                                        <Style Selector="Svg">
                                            <Setter Property="Margin" Value="0 0 5 0" />
                                        </Style>
                                        <Style Selector="ListBoxItem">
                                            <Setter Property="Padding" Value="5" />
                                            <Setter Property="Cursor" Value="Hand" />
                                        </Style>
                                    </ListBox.Styles>
                                    <ListBox.DataTemplates>
                                        <DataTemplate DataType="searchResults:TypeNameSearchResult">
                                            <StackPanel Orientation="Horizontal">
                                                <Svg Path="{DynamicResource ClassIcon}" />
                                                <TextBlock Text="{Binding MatchedString}" />
                                            </StackPanel>
                                        </DataTemplate>
                                        <DataTemplate DataType="searchResults:EventNameSearchResult">
                                            <StackPanel Orientation="Horizontal">
                                                <Svg Path="{DynamicResource EventIcon}" />
                                                <TextBlock Text="{Binding MatchedString}" />
                                            </StackPanel>
                                        </DataTemplate>
                                        <DataTemplate DataType="searchResults:EventTypeSearchResult">
                                            <StackPanel Orientation="Horizontal">
                                                <Svg Path="{DynamicResource EventIcon}" />
                                                <TextBlock Text="{Binding MatchedString}" />
                                            </StackPanel>
                                        </DataTemplate>
                                        <DataTemplate DataType="searchResults:FieldNameSearchResult">
                                            <StackPanel Orientation="Horizontal">
                                                <Svg Path="{DynamicResource FieldIcon}" />
                                                <TextBlock Text="{Binding MatchedString}" />
                                            </StackPanel>
                                        </DataTemplate>
                                        <DataTemplate DataType="searchResults:FieldTypeSearchResult">
                                            <StackPanel Orientation="Horizontal">
                                                <Svg Path="{DynamicResource FieldIcon}" />
                                                <TextBlock Text="{Binding MatchedString}" />
                                            </StackPanel>
                                        </DataTemplate>
                                        <DataTemplate DataType="searchResults:PropertyNameSearchResult">
                                            <StackPanel Orientation="Horizontal">
                                                <Svg Path="{DynamicResource PropertyIcon}" />
                                                <TextBlock Text="{Binding MatchedString}" />
                                            </StackPanel>
                                        </DataTemplate>
                                        <DataTemplate DataType="searchResults:PropertyTypeSearchResult">
                                            <StackPanel Orientation="Horizontal">
                                                <Svg Path="{DynamicResource PropertyIcon}" />
                                                <TextBlock Text="{Binding MatchedString}" />
                                            </StackPanel>
                                        </DataTemplate>
                                        <DataTemplate DataType="searchResults:MethodNameSearchResult">
                                            <StackPanel Orientation="Horizontal">
                                                <Svg Path="{DynamicResource MethodIcon}" />
                                                <TextBlock Text="{Binding MatchedString}" />
                                            </StackPanel>
                                        </DataTemplate>
                                        <DataTemplate DataType="searchResults:MethodReturnTypeSearchResult">
                                            <StackPanel Orientation="Horizontal">
                                                <Svg Path="{DynamicResource MethodIcon}" />
                                                <TextBlock Text="{Binding MatchedString}" />
                                            </StackPanel>
                                        </DataTemplate>
                                        <DataTemplate DataType="searchResults:ParameterNameSearchResult">
                                            <StackPanel Orientation="Horizontal">
                                                <Svg Path="{DynamicResource ParameterIcon}" />
                                                <TextBlock Text="{Binding MatchedString}" />
                                            </StackPanel>
                                        </DataTemplate>
                                        <DataTemplate DataType="searchResults:ParameterTypeSearchResult">
                                            <StackPanel Orientation="Horizontal">
                                                <Svg Path="{DynamicResource ParameterIcon}" />
                                                <TextBlock Text="{Binding MatchedString}" />
                                            </StackPanel>
                                        </DataTemplate>
                                        <DataTemplate DataType="searchResults:VariableNameSearchResult">
                                            <StackPanel Orientation="Horizontal">
                                                <Svg Path="{DynamicResource LocalVariableIcon}" />
                                                <TextBlock Text="{Binding MatchedString}" />
                                            </StackPanel>
                                        </DataTemplate>
                                        <DataTemplate DataType="searchResults:VariableTypeSearchResult">
                                            <StackPanel Orientation="Horizontal">
                                                <Svg Path="{DynamicResource LocalVariableIcon}" />
                                                <TextBlock Text="{Binding MatchedString}" />
                                            </StackPanel>
                                        </DataTemplate>
                                        <DataTemplate DataType="searchResults:StringLiteralSearchResult">
                                            <StackPanel Orientation="Horizontal">
                                                <Svg Path="{DynamicResource StringIcon}" />
                                                <TextBlock Text="{Binding MatchedString}" />
                                            </StackPanel>
                                        </DataTemplate>
                                        <DataTemplate DataType="searchResults:SearchResult">
                                            <StackPanel Orientation="Horizontal">
                                                <!-- Used to keep the space unoccupied and align all elements vertically -->
                                                <Svg Path="{DynamicResource LocalVariableIcon}" Opacity="0" />
                                                <TextBlock Text="{Binding MatchedString}" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </ListBox.DataTemplates>
                                </ListBox>
                            </DockPanel>
                        </Grid>
                    </DockPanel>
                
                    <GridSplitter Grid.Column="1"
                                  ResizeDirection="Columns"
                                  Margin="0 0 5 0" />
                    
                    <Panel Grid.Column="2">
                        <Grid>
                            <!-- Empty grid to fill the space when the TextEditor is hidden to enable drag/drop events -->
                            <Grid Background="Transparent" />

                            <avaloniaEdit:TextEditor Name="TextEditor"
                                                     ShowLineNumbers="True"
                                                     FontFamily="Consolas,Menlo,Courier New,Monospace"
                                                     IsReadOnly="True"
                                                     Document="{Binding Document}"
                                                     IsVisible="{Binding Document, Converter={x:Static ObjectConverters.IsNotNull}}" />
                        </Grid>
                        
                        <Border Background="#66000000"
                                IsVisible="{Binding IsResolving}"
                                IsHitTestVisible="True">
                            <StackPanel HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Spacing="8">
                                <ProgressBar Width="160" IsIndeterminate="True" />
                                <TextBlock Text="Resolving references..." />
                            </StackPanel>
                        </Border>
                    </Panel>
                </Grid>
                
                <Grid Name="DragDropLabel"
                      Background="#33000000"
                      IsVisible="False">
                    <TextBlock VerticalAlignment="Center"
                               HorizontalAlignment="Center"
                               Foreground="#666666">
                        Drop files here
                    </TextBlock>
                </Grid>
            </Grid>
        </DockPanel>
        <views:NotificationsView />
    </Grid>
</Window>
