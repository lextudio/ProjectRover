<UserControl x:Class="ProjectRover.Views.LeftDockView"
             xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:nodes="clr-namespace:ProjectRover.Nodes"
             xmlns:searchResults="clr-namespace:ProjectRover.SearchResults"
             xmlns:vm="using:ProjectRover.ViewModels"
             xmlns:converters="clr-namespace:ProjectRover.Converters"
             x:DataType="vm:MainWindowViewModel">
  <TreeView x:Name="TreeView"
            ItemsSource="{Binding AssemblyNodes}"
            SelectionMode="Single"
            SelectedItem="{Binding SelectedNode}"
            AutoScrollToSelectedItem="True"
            ScrollViewer.HorizontalScrollBarVisibility="Disabled"
            Foreground="{DynamicResource ThemeForegroundBrush}">
    <TreeView.Styles>
      <Style Selector="TextBlock" x:DataType="nodes:Node">
        <Setter Property="Foreground" Value="{Binding IsPublicAPI, Converter={StaticResource ApiVisibilityToBrushConverter}}" />
      </Style>
      <Style Selector="Svg">
        <Setter Property="Margin" Value="0 0 5 0" />
      </Style>
      <Style Selector="TreeViewItem" x:DataType="nodes:Node">
        <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
      </Style>
    </TreeView.Styles>

    <TreeView.DataTemplates>
      <TreeDataTemplate DataType="nodes:AssemblyNode" ItemsSource="{Binding Children}">
        <StackPanel Orientation="Horizontal">
          <Svg Path="{DynamicResource ReferenceIcon}" />
          <TextBlock Text="{Binding Name}"
                     Foreground="{DynamicResource ThemeForegroundBrush}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:MetadataNode" ItemsSource="{Binding Items}">
        <StackPanel Orientation="Horizontal">
          <Svg Path="{DynamicResource MetadataIcon}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:DebugMetadataNode" ItemsSource="{Binding Items}">
        <StackPanel Orientation="Horizontal">
          <Svg Path="{DynamicResource DebugMetadataIcon}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:MetadataTablesNode" ItemsSource="{Binding Items}">
        <StackPanel Orientation="Horizontal">
          <Svg Path="{DynamicResource TablesIcon}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:MetadataHeaderNode">
        <StackPanel Orientation="Horizontal">
          <Svg Path="{DynamicResource HeaderIcon}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:MetadataDirectoryNode">
        <StackPanel Orientation="Horizontal">
          <Svg Path="{DynamicResource FileDialogReportIcon}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:MetadataHeapNode">
        <StackPanel Orientation="Horizontal">
          <Svg Path="{DynamicResource HeapIcon}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:ResourceEntryNode" ItemsSource="{Binding Children}">
        <StackPanel Orientation="Horizontal" Background="Transparent">
          <StackPanel.ContextMenu>
            <ContextMenu>
              <MenuItem Header="Save Resource"
                        Command="{Binding $parent[TreeView].((vm:MainWindowViewModel)DataContext).SaveResourceCommand}"
                        CommandParameter="{Binding .}"
                        IsVisible="{Binding Resource, Converter={x:Static converters:ObjectConverters.IsNotNull}}" />
              <MenuItem Header="Export to .resx"
                        Command="{Binding $parent[TreeView].((vm:MainWindowViewModel)DataContext).ExportResourcesCommand}"
                        CommandParameter="{Binding .}"
                        IsVisible="{Binding Resource, Converter={x:Static converters:ObjectConverters.IsNotNull}}" />
              <MenuItem Header="Extract entries"
                        Command="{Binding $parent[TreeView].((vm:MainWindowViewModel)DataContext).ExtractResourceEntriesCommand}"
                        CommandParameter="{Binding .}"
                        IsVisible="{Binding Resource, Converter={x:Static converters:ObjectConverters.IsNotNull}}" />
              <MenuItem Header="Save entry"
                        Command="{Binding $parent[TreeView].((vm:MainWindowViewModel)DataContext).SaveObjectEntryCommand}"
                        CommandParameter="{Binding .}"
                        IsVisible="{Binding Raw, Converter={x:Static converters:ObjectConverters.IsNotNull}}" />
            </ContextMenu>
          </StackPanel.ContextMenu>
          <Svg Path="{Binding IconKey, Converter={StaticResource IconKeyToPathConverter}}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:MetadataTableNode">
        <StackPanel Orientation="Horizontal">
          <Svg Path="{DynamicResource DataTableIcon}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:MetadataLeafNode">
        <StackPanel Orientation="Horizontal">
          <Svg Path="{DynamicResource MetadataIcon}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:ReferencesNode" ItemsSource="{Binding Items}">
        <StackPanel Orientation="Horizontal">
          <Svg Path="{DynamicResource ReferenceGroupIcon}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:ResourcesNode" ItemsSource="{Binding Items}">
        <StackPanel Orientation="Horizontal" Background="Transparent">
          <StackPanel.ContextMenu>
            <ContextMenu>
              <MenuItem Header="Export All Resources"
                        Command="{Binding $parent[TreeView].((vm:MainWindowViewModel)DataContext).ExportAllResourcesCommand}"
                        CommandParameter="{Binding .}" />
            </ContextMenu>
          </StackPanel.ContextMenu>
          <Panel>
            <Svg Path="{DynamicResource ResourcesIconClosed}" IsVisible="{Binding !IsExpanded}" />
            <Svg Path="{DynamicResource ResourcesIconOpen}" IsVisible="{Binding IsExpanded}" />
          </Panel>
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:ResolvedReferenceNode">
        <StackPanel Orientation="Horizontal">
          <Svg Path="{DynamicResource ReferenceIcon}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:UnresolvedReferenceNode">
        <StackPanel Orientation="Horizontal">
          <Svg Path="{DynamicResource ReferenceWarningIcon}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:NamespaceNode" ItemsSource="{Binding Types}">
        <StackPanel Orientation="Horizontal">
          <Svg Path="{DynamicResource NamespaceIcon}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:EnumNode" ItemsSource="{Binding Members}">
        <StackPanel Orientation="Horizontal">
          <Svg Path="{DynamicResource EnumIcon}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:StructNode" ItemsSource="{Binding Members}">
        <StackPanel Orientation="Horizontal">
          <Svg Path="{DynamicResource StructIcon}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:ClassNode" ItemsSource="{Binding Members}">
        <StackPanel Orientation="Horizontal">
          <Svg Path="{Binding IconKey, Converter={StaticResource IconKeyToPathConverter}}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:InterfaceNode" ItemsSource="{Binding Members}">
        <StackPanel Orientation="Horizontal">
          <Svg Path="{DynamicResource InterfaceIcon}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:BaseTypesNode" ItemsSource="{Binding Items}">
        <StackPanel Orientation="Horizontal">
          <Svg Path="{DynamicResource ReferenceGroupIcon}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:BaseTypeNode">
        <StackPanel Orientation="Horizontal">
          <Svg Path="{Binding IconKey, Converter={StaticResource IconKeyToPathConverter}}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:FieldNode">
        <StackPanel Orientation="Horizontal">
          <StackPanel.ContextMenu>
            <ContextMenu>
              <MenuItem Header="Find Usages"
                        Command="{Binding $parent[TreeView].((vm:MainWindowViewModel)DataContext).FindUsagesCommand}" />
            </ContextMenu>
          </StackPanel.ContextMenu>
          <Svg Path="{Binding IconKey, Converter={StaticResource IconKeyToPathConverter}}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:PropertyNode">
        <StackPanel Orientation="Horizontal">
          <StackPanel.ContextMenu>
            <ContextMenu>
              <MenuItem Header="Find Usages"
                        Command="{Binding $parent[TreeView].((vm:MainWindowViewModel)DataContext).FindUsagesCommand}" />
            </ContextMenu>
          </StackPanel.ContextMenu>
          <Svg Path="{Binding IconKey, Converter={StaticResource IconKeyToPathConverter}}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:ConstructorNode">
        <StackPanel Orientation="Horizontal">
          <StackPanel.ContextMenu>
            <ContextMenu>
              <MenuItem Header="Find Usages"
                        Command="{Binding $parent[TreeView].((vm:MainWindowViewModel)DataContext).FindUsagesCommand}" />
            </ContextMenu>
          </StackPanel.ContextMenu>
          <Svg Path="{Binding IconKey, Converter={StaticResource IconKeyToPathConverter}}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:MethodNode">
        <StackPanel Orientation="Horizontal">
          <StackPanel.ContextMenu>
            <ContextMenu>
              <MenuItem Header="Find Usages"
                        Command="{Binding $parent[TreeView].((vm:MainWindowViewModel)DataContext).FindUsagesCommand}" />
            </ContextMenu>
          </StackPanel.ContextMenu>
          <Svg Path="{Binding IconKey, Converter={StaticResource IconKeyToPathConverter}}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
      <TreeDataTemplate DataType="nodes:EventNode">
        <StackPanel Orientation="Horizontal">
          <StackPanel.ContextMenu>
            <ContextMenu>
              <MenuItem Header="Find Usages"
                        Command="{Binding $parent[TreeView].((vm:MainWindowViewModel)DataContext).FindUsagesCommand}" />
            </ContextMenu>
          </StackPanel.ContextMenu>
          <Svg Path="{Binding IconKey, Converter={StaticResource IconKeyToPathConverter}}" />
          <TextBlock Text="{Binding Name}" />
        </StackPanel>
      </TreeDataTemplate>
    </TreeView.DataTemplates>
  </TreeView>
</UserControl>
